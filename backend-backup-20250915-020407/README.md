# æ‡‚æ‹å¸åç«¯æœåŠ¡

é‡æ„åçš„æ¨¡å—åŒ–åç«¯æœåŠ¡ï¼Œæä¾›æ¸…æ™°çš„ä»£ç ç»„ç»‡å’Œå¯æ‰©å±•æ€§ã€‚

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ index.js      # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.js       # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ errorHandler.js # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ index.js      # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ routes/           # è·¯ç”±æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth.js       # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ users.js      # ç”¨æˆ·ç®¡ç†è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ works.js      # ä½œå“ç®¡ç†è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ appointments.js # çº¦æ‹ç®¡ç†è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ messages.js   # æ¶ˆæ¯ç®¡ç†è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ payments.js   # æ”¯ä»˜ç®¡ç†è·¯ç”±
â”‚   â”‚   â””â”€â”€ stats.js      # ç»Ÿè®¡æ•°æ®è·¯ç”±
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ logger.js     # æ—¥å¿—å·¥å…·
â”‚   â”‚   â””â”€â”€ response.js   # å“åº”å¤„ç†å·¥å…·
â”‚   â””â”€â”€ index.js          # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ package.json          # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md            # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹é…ç½®
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘ç¯å¢ƒ
npm run dev

# ç”Ÿäº§ç¯å¢ƒ
npm start

# ä½¿ç”¨PM2å¯åŠ¨
pm2 start src/index.js --name dongpaidi-api
```

## ğŸ“¡ API ç«¯ç‚¹

### è®¤è¯ç›¸å…³
- `POST /api/v1/admin/login` - ç®¡ç†å‘˜ç™»å½•
- `GET /api/v1/admin/profile` - è·å–ç”¨æˆ·ä¿¡æ¯
- `POST /api/v1/admin/logout` - ç®¡ç†å‘˜ç™»å‡º
- `POST /api/v1/admin/change-password` - ä¿®æ”¹å¯†ç 

### ç”¨æˆ·ç®¡ç†
- `GET /api/v1/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `GET /api/v1/users/stats` - è·å–ç”¨æˆ·ç»Ÿè®¡
- `GET /api/v1/users/:id` - è·å–ç”¨æˆ·è¯¦æƒ…
- `PUT /api/v1/users/:id` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- `DELETE /api/v1/users/:id` - åˆ é™¤ç”¨æˆ·

### ä½œå“ç®¡ç†
- `GET /api/v1/works` - è·å–ä½œå“åˆ—è¡¨
- `GET /api/v1/works/stats` - è·å–ä½œå“ç»Ÿè®¡
- `GET /api/v1/works/:id` - è·å–ä½œå“è¯¦æƒ…
- `PUT /api/v1/works/:id/status` - æ›´æ–°ä½œå“çŠ¶æ€
- `DELETE /api/v1/works/:id` - åˆ é™¤ä½œå“

### çº¦æ‹ç®¡ç†
- `GET /api/v1/appointments` - è·å–çº¦æ‹åˆ—è¡¨
- `GET /api/v1/appointments/stats` - è·å–çº¦æ‹ç»Ÿè®¡
- `GET /api/v1/appointments/:id` - è·å–çº¦æ‹è¯¦æƒ…
- `PUT /api/v1/appointments/:id/status` - æ›´æ–°çº¦æ‹çŠ¶æ€
- `DELETE /api/v1/appointments/:id` - åˆ é™¤çº¦æ‹

### æ¶ˆæ¯ç®¡ç†
- `GET /api/v1/messages/unread-count` - è·å–æœªè¯»æ¶ˆæ¯æ•°é‡
- `GET /api/v1/messages/conversations` - è·å–å¯¹è¯åˆ—è¡¨

### æ”¯ä»˜ç®¡ç†
- `GET /api/v1/payments/admin/stats` - è·å–æ”¯ä»˜ç»Ÿè®¡
- `GET /api/v1/payments/admin/orders` - è·å–è®¢å•åˆ—è¡¨

### ç»Ÿè®¡æ•°æ®
- `GET /api/v1/stats` - è·å–ç³»ç»Ÿæ€»ä½“ç»Ÿè®¡
- `GET /api/v1/stats/trend` - è·å–è¶‹åŠ¿æ•°æ®

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `PORT` | æœåŠ¡ç«¯å£ | 3000 |
| `NODE_ENV` | è¿è¡Œç¯å¢ƒ | development |
| `ADMIN_USERNAME` | ç®¡ç†å‘˜ç”¨æˆ·å | admin@dongpaidi.com |
| `ADMIN_PASSWORD` | ç®¡ç†å‘˜å¯†ç  | admin123456 |
| `SESSION_SECRET` | ä¼šè¯å¯†é’¥ | dongpaidi-secret-key |
| `LOG_LEVEL` | æ—¥å¿—çº§åˆ« | info |

### é…ç½®æ–‡ä»¶

ä¸»é…ç½®æ–‡ä»¶ä½äº `src/config/index.js`ï¼ŒåŒ…å«ï¼š
- æœåŠ¡å™¨é…ç½®
- ç®¡ç†å‘˜è´¦æˆ·é…ç½®
- å®‰å…¨é…ç½®
- æ—¥å¿—é…ç½®
- APIé…ç½®
- æ•°æ®åº“é…ç½®ï¼ˆä¸ºå°†æ¥æ‰©å±•å‡†å¤‡ï¼‰

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- ä¼šè¯ç®¡ç†å’Œè®¤è¯ä¸­é—´ä»¶
- è¯·æ±‚å‚æ•°éªŒè¯
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- CORSé…ç½®
- è¯·æ±‚ä½“å¤§å°é™åˆ¶

## ğŸ“Š æ—¥å¿—ç³»ç»Ÿ

æ”¯æŒå¤šçº§åˆ«æ—¥å¿—è®°å½•ï¼š
- `ERROR` - é”™è¯¯ä¿¡æ¯
- `WARN` - è­¦å‘Šä¿¡æ¯
- `INFO` - ä¸€èˆ¬ä¿¡æ¯
- `DEBUG` - è°ƒè¯•ä¿¡æ¯

æ—¥å¿—å¯ä»¥è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶ã€‚

## ğŸ”„ æ•°æ®æ¨¡å‹

é‡‡ç”¨æ¨¡å—åŒ–çš„æ•°æ®æ¨¡å‹è®¾è®¡ï¼š
- `BaseModel` - åŸºç¡€æ¨¡å‹ç±»ï¼Œæä¾›é€šç”¨CRUDæ“ä½œ
- `UserModel` - ç”¨æˆ·æ¨¡å‹
- `WorkModel` - ä½œå“æ¨¡å‹
- `AppointmentModel` - çº¦æ‹æ¨¡å‹
- `MessageModel` - æ¶ˆæ¯æ¨¡å‹
- `PaymentModel` - æ”¯ä»˜æ¨¡å‹
- `StatsModel` - ç»Ÿè®¡æ¨¡å‹

## ğŸš€ éƒ¨ç½²è¯´æ˜

### ä½¿ç”¨PM2éƒ¨ç½²

```bash
# å¯åŠ¨æœåŠ¡
pm2 start src/index.js --name dongpaidi-api

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs dongpaidi-api

# é‡å¯æœåŠ¡
pm2 restart dongpaidi-api
```

### Nginxé…ç½®

ç¡®ä¿Nginxé…ç½®æ­£ç¡®ä»£ç†APIè¯·æ±‚åˆ°åç«¯æœåŠ¡ã€‚

## ğŸ”® æœªæ¥æ‰©å±•

- æ•°æ®åº“é›†æˆï¼ˆMySQL/PostgreSQL/MongoDBï¼‰
- Redisç¼“å­˜æ”¯æŒ
- æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- é‚®ä»¶é€šçŸ¥ç³»ç»Ÿ
- å®æ—¶æ¶ˆæ¯æ¨é€
- APIé™æµå’Œé˜²æŠ¤
- å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„APIç«¯ç‚¹

1. åœ¨ç›¸åº”çš„è·¯ç”±æ–‡ä»¶ä¸­æ·»åŠ è·¯ç”±å¤„ç†å‡½æ•°
2. ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼ˆ`res.success()` æˆ– `res.error()`ï¼‰
3. æ·»åŠ é€‚å½“çš„JSDocæ³¨é‡Š
4. æ›´æ–°æœ¬æ–‡æ¡£

### é”™è¯¯å¤„ç†

ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š
- æŠ›å‡º `AppError` å®ä¾‹
- ä½¿ç”¨ `asyncHandler` åŒ…è£…å¼‚æ­¥è·¯ç”±å¤„ç†å‡½æ•°
- è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

### æ—¥å¿—è®°å½•

ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—å·¥å…·ï¼š
```javascript
const logger = require('../utils/logger');

logger.info('æ“ä½œæˆåŠŸ', { userId: 123 });
logger.error('æ“ä½œå¤±è´¥', { error: error.message });
```
