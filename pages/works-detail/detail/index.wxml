<!--ä½œå“è¯¦æƒ…é¡µ - å¾—ç‰©é£æ ¼-->
<view class="work-detail-page">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="custom-navbar">
    <view class="nav-left" bindtap="onBackTap">
      <t-icon name="chevron-left" size="48rpx" color="#333" />
    </view>
    <view class="nav-right">
      <view class="nav-btn" bindtap="onShareTap">
        <t-icon name="share" size="40rpx" color="#333" />
      </view>
    </view>
  </view>

  <!-- ä½œå“å†…å®¹åŒºåŸŸ -->
  <scroll-view class="content-scroll" scroll-y="true" wx:if="{{!loading && workDetail}}">
    <!-- ä½œå“å›¾ç‰‡å±•ç¤º -->
    <view class="work-image-section">
      <swiper
        class="work-images"
        indicator-dots="{{workDetail.images && workDetail.images.length > 1}}"
        indicator-color="rgba(255,255,255,0.3)"
        indicator-active-color="rgba(212,175,55,0.8)"
        bindchange="onImageChange"
        circular="{{true}}"
      >
        <swiper-item wx:for="{{workDetail.images || [workDetail.coverImage]}}" wx:key="*this">
          <image
            class="work-image"
            src="{{item}}"
            mode="aspectFill"
            bindtap="onImagePreview"
            data-index="{{index}}"
            lazy-load="{{true}}"
          />
        </swiper-item>
      </swiper>

      <!-- å›¾ç‰‡æŒ‡ç¤ºå™¨ -->
      <view class="image-indicator" wx:if="{{workDetail.images && workDetail.images.length > 1}}">
        <text>{{currentImageIndex + 1}}/{{workDetail.images.length}}</text>
      </view>

      <!-- å›¾ç‰‡æ“ä½œæŒ‰é’® -->
      <view class="image-actions">
        <view class="action-btn" bindtap="onImagePreview">
          <text class="action-icon">ğŸ”</text>
        </view>
        <view class="action-btn" bindtap="onShareImage">
          <text class="action-icon">ğŸ“¤</text>
        </view>
      </view>
    </view>

    <!-- ä½œå“ä¿¡æ¯ä¸»å¡ç‰‡ -->
    <view class="work-main-card">
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="user-section">
        <view class="user-info" bindtap="onUserTap" data-user-id="{{workDetail.user.id}}">
          <image class="user-avatar" src="{{workDetail.user.avatar}}" mode="aspectFill" />
          <view class="user-details">
            <text class="user-name">{{workDetail.user.name}}</text>
            <view class="user-meta">
              <text class="user-desc">{{workDetail.user.description || 'æ‘„å½±çˆ±å¥½è€…'}}</text>
              <text class="publish-time">{{workDetail.publishTime}}</text>
            </view>
          </view>
        </view>
        <view class="user-actions">
          <view
            class="follow-btn {{workDetail.user.isFollowed ? 'followed' : ''}}"
            bindtap="onFollowTap"
          >
            <text class="follow-text">{{workDetail.user.isFollowed ? 'å·²å…³æ³¨' : '+ å…³æ³¨'}}</text>
          </view>
        </view>
      </view>

      <!-- ä½œå“æ ‡é¢˜å’Œæè¿° -->
      <view class="work-content">
        <text class="work-title">{{workDetail.title}}</text>
        <text class="work-description" wx:if="{{workDetail.description}}">{{workDetail.description}}</text>

        <!-- ä½œå“æ ‡ç­¾ -->
        <view class="work-tags" wx:if="{{workDetail.tags && workDetail.tags.length > 0}}">
          <text class="tag-item" wx:for="{{workDetail.tags}}" wx:key="*this">
            #{{item}}
          </text>
        </view>

        <!-- æ‹æ‘„åœ°ç‚¹ -->
        <view class="work-location" wx:if="{{workDetail.location}}" bindtap="onLocationTap">
          <text class="location-icon">ğŸ“</text>
          <text class="location-text">{{workDetail.location}}</text>
        </view>
      </view>
    </view>

    <!-- æ‹æ‘„å‚æ•°å¡ç‰‡ -->
    <view class="params-card" wx:if="{{workDetail.params}}">
      <view class="card-header">
        <text class="card-title">ğŸ“· æ‹æ‘„å‚æ•°</text>
      </view>
      <view class="params-grid">
        <view class="param-item" wx:if="{{workDetail.params.camera}}">
          <text class="param-label">ç›¸æœº</text>
          <text class="param-value">{{workDetail.params.camera}}</text>
        </view>
        <view class="param-item" wx:if="{{workDetail.params.lens}}">
          <text class="param-label">é•œå¤´</text>
          <text class="param-value">{{workDetail.params.lens}}</text>
        </view>
        <view class="param-item" wx:if="{{workDetail.params.aperture}}">
          <text class="param-label">å…‰åœˆ</text>
          <text class="param-value">{{workDetail.params.aperture}}</text>
        </view>
        <view class="param-item" wx:if="{{workDetail.params.shutter}}">
          <text class="param-label">å¿«é—¨</text>
          <text class="param-value">{{workDetail.params.shutter}}</text>
        </view>
        <view class="param-item" wx:if="{{workDetail.params.iso}}">
          <text class="param-label">ISO</text>
          <text class="param-value">{{workDetail.params.iso}}</text>
        </view>
        <view class="param-item" wx:if="{{workDetail.params.focal}}">
          <text class="param-label">ç„¦è·</text>
          <text class="param-value">{{workDetail.params.focal}}</text>
        </view>
        <view class="param-item" wx:if="{{workDetail.params.location}}">
          <text class="param-label">æ‹æ‘„åœ°ç‚¹</text>
          <text class="param-value">{{workDetail.params.location}}</text>
        </view>
      </view>
    </view>

    <!-- ç›¸å…³æœç´¢ -->
    <view class="related-search" wx:if="{{workDetail.relatedTags}}">
      <view class="search-header">
        <t-icon name="search" size="32rpx" color="#666" />
        <text class="search-title">ç›¸å…³æœç´¢ Â· {{workDetail.category}}æ¨è</text>
        <t-icon name="chevron-right" size="32rpx" color="#999" />
      </view>
    </view>

    <!-- è¯„è®ºåŒºåŸŸ -->
    <view class="comments-section">
      <view class="comments-header">
        <text class="comments-title">è¯„è®º {{workDetail.stats.comments}}</text>
        <view class="comments-tabs">
          <text class="tab-item {{commentTab === 'hot' ? 'active' : ''}}" bindtap="onCommentTabTap" data-tab="hot">çƒ­é—¨</text>
          <text class="tab-item {{commentTab === 'latest' ? 'active' : ''}}" bindtap="onCommentTabTap" data-tab="latest">æœ€æ–°</text>
        </view>
      </view>

      <!-- è¯„è®ºåˆ—è¡¨ -->
      <view class="comments-list">
        <view class="comment-item" wx:for="{{comments}}" wx:key="id">
          <image class="comment-avatar" src="{{item.user.avatar}}" />
          <view class="comment-content">
            <view class="comment-header">
              <text class="comment-user">{{item.user.name}}</text>
              <text class="comment-time">{{item.timeText}}</text>
            </view>
            <text class="comment-text">{{item.content}}</text>
            <view class="comment-actions">
              <view class="comment-like {{item.isLiked ? 'liked' : ''}}" bindtap="onCommentLike" data-comment="{{item}}">
                <t-icon name="thumb-up" size="24rpx" />
                <text wx:if="{{item.likes > 0}}">{{item.likes}}</text>
              </view>
              <text class="comment-reply" bindtap="onCommentReply" data-comment="{{item}}">å›å¤</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="safe-area-bottom"></view>
  </scroll-view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-action-bar" wx:if="{{!loading && workDetail}}">
    <view class="comment-input" bindtap="onCommentInputTap">
      <text class="input-placeholder">è¯´ç‚¹ä»€ä¹ˆ...</text>
    </view>
    <view class="action-buttons">
      <view class="action-btn {{workDetail.isLiked ? 'liked' : ''}}" bindtap="onLikeTap">
        <t-icon name="thumb-up" size="44rpx" />
        <text class="action-count">{{workDetail.stats.likes}}</text>
      </view>
      <view class="action-btn {{workDetail.isCollected ? 'collected' : ''}}" bindtap="onCollectTap">
        <t-icon name="star" size="44rpx" />
        <text class="action-count">{{workDetail.stats.collections}}</text>
      </view>
      <view class="action-btn" bindtap="onCommentTap">
        <t-icon name="chat" size="44rpx" />
        <text class="action-count">{{workDetail.stats.comments}}</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <t-loading theme="circular" size="60rpx" />
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
